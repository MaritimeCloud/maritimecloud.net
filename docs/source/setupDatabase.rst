Setting up database
====================
Prerequisite of installing both Keycloak and identity registry API is an installation of MariaDB. For Keycloak, it is important to set exactly same environment defined in the dockerfile of MCPKeycloakSPI (https://github.com/MaritimeConnectivityPlatform/MCPKeycloakSpi/blob/ master/docker/Dockerfile). For example, if it contains ‘ENV DB_DATABASE keycloak’, you have to create a database ‘keycloak’ through CREATE DATABASE keycloak;. It is also required to set a dedicated user id in mysql.user and a password that perfectly corresponds to the values in the dockerfile. For the case using the prebuilt Docker container will be described later the database environment setup should be matched to the dockerfile of the repository of it.
Identity registry API provides bash files to setup the initial database, which are available on the repository (https://github.com/MaritimeConnectivityPlatform/IdentityRegistry/tree/master/setup). ‘setup-db.sh’ that should be executed first includes execution of a series of SQL statements in ‘create-database-and-user.sql’. After that flywaydb will handle creation and migration of tables when the program starts, and will fail if the tables already exists. Importing the content from ‘create-mc-org.sql’ should only be done after the first execution as described in the section Putting everything together. For the case to remove the database and the user you can just execute ‘drop- db.sh’ or just ‘drop-db-and-user.sql’.
